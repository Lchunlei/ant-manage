<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=emulateIE7" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../css/style.css" />
<link rel="stylesheet" type="text/css" href="../css/WdatePicker.css" />
<link rel="stylesheet" type="text/css" href="../css/skin_/table.css" />
<link rel="stylesheet" type="text/css" href="../css/jquery.grid.css" />


<title>用户管理</title>
</head>

<body>
<div id="container">
	<div id="hd"></div>
    <div id="bd">
    	<div id="main">
        	<div class="search-box ue-clear">
            	<div class="search-area">
                    <div class="kv-item ue-clear">
                        <label>选择时间：</label>
                        <div class="kv-item-content ue-clear">
                            <!--
                            <span class="choose">
                                <span class="checkboxouter">
                                    <input type="radio" name="time" />
                                    <span class="radio"></span>
                                </span>
                                <span class="text">全部</span>
                            </span>
                            -->
                            <form id="userList">
                            <span class="choose">
                                <span class="checkboxouter">
                                    <input type="radio" name="seleTime" value="3"/>
                                    <span class="radio"></span>
                                </span>
                                <span class="text">近3天</span>
                            </span>
                            <span class="choose">
                                <span class="checkboxouter">
                                    <input type="radio" name="seleTime" value="7"/>
                                    <span class="radio"></span>
                                </span>
                                <span class="text">近一周</span>
                            </span>
                            <span class="choose">
                                <span class="checkboxouter">
                                    <input type="radio" name="seleTime" value="30"/>
                                    <span class="radio"></span>
                                </span>
                                <span class="text">近一月</span>
                            </span>
                            <span class="choose">
                                <span class="checkboxouter">
                                    <input type="radio" name="seleTime" value=""/>
                                    <span class="radio"></span>
                                </span>
                                <span class="text">全部</span>
                            </span>
                            <!--
                            <span class="choose">
                                <span class="checkboxouter">
                                    <input type="radio" name="time" data-define="define" />
                                    <span class="radio"></span>
                                </span>
                                <span class="text">自定义</span>
                            </span>
                            <span class="define-input">
                            	<input type="text" placeholder="开始时间" />
                                <span class="division"></span>
                                <input type="text" placeholder="结束时间" />
                            </span>
                            -->
                        </div>
                    </div>
                    <div class="kv-item ue-clear">
                        <label>昵称或ID:</label>
                        <div class="kv-item-content">
                            <input name="nameOrId"/>
                        </div>
                    </div>
                </div>
                <div class="search-button">
                	<input class="button" type="button" onclick="getUserList(1)" value="搜索一下" />
                </div>
                </form>
             </div>
             
            <div class="table">
            	<div class="opt ue-clear">
                	<span class="sortarea">
                    	<span class="sort">
                        	<label>排序：</label>
                            <span class="name">
                            	<i class="icon"></i>
                                <span class="text">名称</span>
                            </span>
                        </span>
                        
                        <i class="list"></i>
                        <i class="card"></i>
                    </span>
                	<span class="optarea">
                        <a href="javascript:;" class="add">
                            <i class="icon"></i>
                            <span class="text">添加</span>
                        </a>
                        <a href="javascript:;" class="delete">
                            <i class="icon"></i>
                            <span class="text">删除</span>
                        </a>
                        
                        <a href="javascript:;" class="statistics">
                            <i class="icon"></i>
                            <span class="text">统计</span>
                        </a>
                        
                        <a href="javascript:;" class="config">
                            <i class="icon"></i>
                            <span class="text">配置</span>
                        </a>
                    </span>
                </div>
                
                <div class="grid"></div>
                
                <div class="pagination"></div>
            </div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src="../js/jquery.js"></script>
<script type="text/javascript" src="../js/global.js"></script>
<script type="text/javascript" src="../js/jquery.select.js"></script>
<script type="text/javascript" src="../js/core.js"></script>
<script type="text/javascript" src="../js/jquery.pagination.js"></script>
<script type="text/javascript" src="../js/jquery.grid.js"></script>
<script type="text/javascript" src="../js/WdatePicker.js"></script>
<script type="text/javascript">
	$('select').select();
	var head = [{
				label: 'ID',
				width: 100,
				sortable: 'default',
				name: 'userId'
			},{
				label:'昵称',
				width: 150,
				sortable: 'default',
				name:'nickName'
			},{
				label:'状态',
                name: 'nickName',
				width:150
			},{
				label: '设备',
				width: 150
			},{
				label: '用户地址',
				minWidth: 200
			},{
				label: '创建日期',
				width: 120
			},{
				label: '是否审核',
				width:100
			}];

		$('.grid').Grid({
			thead: head,
			tbody: null,
			height:400,
			checkbox: {
				single:true
			},
			operator: {
				type : "normal",
				width : 100
			},
			sortCallBack : function(name,index,type){
				alert(name+","+index+','+type);
			}

		});

	$('.grid').Grid('addLoading');

	$('.search-box input[type=radio]').click(function(e) {
        if($(this).prop('checked')){
			if($(this).attr('data-define') === 'define'){
				$('.define-input').show();
			}else{
				$('.define-input').hide();
			}
		}
    });

    var allNum = 0;
    //首次打开页面加载
    getUserList(1);
    //条件搜索
    function getUserList(pageNum){
        if(pageNum==1){
            fenye();
        }
        var userform = new FormData(document.getElementById("userList"));
        userform.append("pageSize", 10);
        userform.append("pageNum", pageNum);
        $.ajax({
            url:"./ant/manage/user/list",
            type:"post",
            data:userform,
            processData:false,
            contentType:false,
            success:function(data){
                console.log("over.."+data.message);
                console.log("Start.....");
                var tbody = [];
                if("R000"==data.code){
                    var thisList = data.webData;
                    console.log("--"+thisList.length);
                    for(var i in thisList){
                        console.log(i+"--");
                        var tsun = [];
                        console.log(i+"--"+thisList[i].nickName);
                        tsun.push(thisList[i].userId);
                        tsun.push(thisList[i].nickName);
                        tsun.push(thisList[i].status==0?'启用中':'禁用中');
                        tsun.push(thisList[i].plantForm);
                        tsun.push(thisList[i].address);
                        tsun.push(thisList[i].createTime);
                        tsun.push("已审核");
                        var oper = [{label:'停用',id:thisList[i].userId,onclick:function(){
                                $.ajax({
                                    url: "./ant/manage/user/status",
                                    dataType: 'json',
                                    method: 'GET',
                                    data : {
                                        userId : this.id,
                                        status : 1
                                    },
                                    success: function(data) {
                                        alert(data.message);
                                    },
                                    error: function(xhr) {
                                        // 导致出错的原因较多，以后再研究
                                        alert("服务异常！！");
                                    }
                                });
                                //alert('停用'+this.id);
                            }},{label:'启用',id:thisList[i].userId,onclick: function(){
                                $.ajax({
                                    url: "./ant/manage/user/status",
                                    dataType: 'json',
                                    method: 'GET',
                                    data : {
                                        userId : this.id,
                                        status : 0
                                    },
                                    success: function(data) {
                                        alert(data.message);
                                    },
                                    error: function(xhr) {
                                        // 导致出错的原因较多，以后再研究
                                        alert("服务异常！！");
                                    }
                                });
                                //alert('启用'+tsun[0]);
                            }}];
                        tsun.push(oper);
                        tbody.push(tsun);
                    }
                    tbody.pop();
                }else{
                    //alert(data.message);
                }
                console.log(data.code);
                console.log(data.message);
                console.log("over.."+data.total);
                allNum=data.total;
                //重新加载表单
                $('.grid').Grid('setData',tbody, head);

            },
            error:function(e){
                alert("错误！！");

            }
        });
    }
    function fenye() {
        console.log("*********>>>>>"+allNum);
        if(allNum==0){
            /// 模拟异步
            setTimeout(function(){
                fenye();
            },500);
        }else {
            //分页工具
            $('.pagination').pagination(allNum,{
                callback: function(page){
                    getUserList(page+1);
                    //page为当前页数
                },
                display_msg: false
            });
        }

    }

</script>
</html>
